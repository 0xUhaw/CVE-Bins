## PHP-Proxy Encrypt Key Flaw and LFI Vulnerability Description
 - Author: YU-HSIANG HUANG, YUNG-HAO TSENG, Eddie TC CHANG
 - Contact: huang.yuhsiang.phone@gmail.com; 0xuhaw@gmail.com; eddietcchang@gmail.com
---
 ### Testing Target
 - Product: PHP-Proxy
 - Version: 5.1.0
 - Affect: All Version
 - Official Website: https://www.php-proxy.com/
 - Github: https://github.com/Athlon1600/php-proxy-app

 ### Abstract
We discovered the PHP-Proxy `str_rot_pass` encrypt function  is flawed. Despite the user change the default key, the remote attacker can easily decrypt the key and cause the vulnerability of Local File Inclusion.

 ### Concept
 1. First, we download the latest version from the official website and check `helpers.php` code.
![](./png/1.png)

 2. From `helpers.php` code, we discovered `str_rot_pass` encrypt function is flawed. Maybe it is not rigorous enough, it is easy to be cracked.
![](./png/2.png)

 3. We write a sample payload that It only applies to such a condition. If you want to change the conditions, then you may need to rewrite the payload. Download Link [Click](https://github.com/0xUhaw/CVE-Bins/blob/master/PHP-Proxy/_crack-PHP-Proxy.php)
 * [url_mode] set 2 (default)
 * Not disable curl file protocol
![](./png/3.png)

4. Use payload to decrypt the key and get decrypt key link.
![](./png/4-1.png)

5. Successfully obtained passwd file
![](./png/5.png)

 ### Instance
This is an actual case. We can see that the remote attacker can quickly get the target passwd or other information.
![](./png/6.png)
![](./png/7.png)
![](./png/8.png)
